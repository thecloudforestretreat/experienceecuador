<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Misahuallí | Experience Ecuador</title>

  <!-- Favicons (approved root paths) -->
  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="icon" href="/favicon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="manifest" href="/site.webmanifest">
  <meta name="theme-color" content="#034EA2">

  <!-- Global header/footer CSS (required) -->
  <link rel="stylesheet" href="/assets/css/header.css">
  <link rel="stylesheet" href="/assets/css/footer.css">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --brand-blue:#034EA2;
      --slate:#6E7B8B;
      --text:#1F1F1F;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:#f6f8fb;
      color:var(--text);
    }

    a{text-decoration:none;color:inherit}
    img{max-width:100%;display:block;user-select:none;-webkit-user-drag:none}

    /* ===== CONTENT ===== */
    .wrap{
      max-width:1100px;
      margin:0 auto;
      padding:40px 18px 56px;
    }

    h1{
      font-family:Montserrat,Inter,sans-serif;
      font-size:clamp(34px,4vw,54px);
      color:var(--brand-blue);
      margin:0 0 10px;
      letter-spacing:-0.03em;
    }

    .lede{
      color:var(--slate);
      line-height:1.65;
      max-width:92ch;
      margin:0;
      font-size:16.8px;
    }

    .meta-row{
      margin-top:14px;
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      color:#162b55;
      font-weight:700;
      font-size:13.5px;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 12px;
      border-radius:999px;
      background:rgba(3,78,162,.06);
      border:1px solid rgba(3,78,162,.14);
      color:#0f2f62;
      font-weight:800;
    }

    .content-grid{
      display:grid;
      grid-template-columns:1.15fr 0.85fr;
      gap:22px;
      margin-top:22px;
      align-items:start;
    }

    .card{
      background:#fff;
      padding:22px;
      border-radius:22px;
      box-shadow:0 18px 55px rgba(3,78,162,.12);
      border:1px solid rgba(0,0,0,.06);
    }

    .card + .card{ margin-top:16px; }

    .card h2{
      margin:0 0 10px;
      font-family:Montserrat,Inter,sans-serif;
      font-weight:800;
      letter-spacing:-0.02em;
      font-size:18px;
      color:#0f2f62;
    }

    .card p{
      margin:0 0 12px;
      color:#1f2b3f;
      line-height:1.75;
      font-size:15.5px;
      max-width:84ch;
    }

    .card p:last-child{ margin-bottom:0; }

    .inline-link{
      text-decoration:underline;
      text-underline-offset:3px;
      font-weight:800;
      color:#162b55;
    }

    .two-col{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:14px;
      margin-top:10px;
    }

    .mini-card{
      padding:14px 14px;
      border-radius:18px;
      background:linear-gradient(180deg, rgba(3,78,162,.045), rgba(3,78,162,.02));
      border:1px solid rgba(3,78,162,.12);
    }

    .mini-card h3{
      margin:0 0 6px;
      font-size:14.5px;
      font-weight:900;
      color:#0f2f62;
      letter-spacing:-0.01em;
    }

    .mini-card p{
      margin:0;
      color:#1f2b3f;
      opacity:.92;
      line-height:1.6;
      font-size:14.4px;
    }

    .chips{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top:10px;
    }

    .chip{
      display:inline-flex;
      align-items:center;
      padding:7px 10px;
      border-radius:999px;
      background:rgba(3,78,162,.06);
      border:1px solid rgba(3,78,162,.14);
      color:#0f2f62;
      font-weight:800;
      font-size:12.8px;
    }

    .side-stack{
      display:flex;
      flex-direction:column;
      gap:16px;
    }

    .mini{
      background:#fff;
      padding:20px;
      border-radius:22px;
      box-shadow:0 18px 55px rgba(3,78,162,.12);
      border:1px solid rgba(0,0,0,.06);
    }

    .mini h3{
      margin:0 0 10px;
      font-family:Montserrat,Inter,sans-serif;
      font-weight:800;
      letter-spacing:-0.02em;
      font-size:16px;
      color:#0f2f62;
    }

    .mini p{
      margin:0;
      color:var(--slate);
      line-height:1.65;
      font-size:14.8px;
    }

    .link-list{
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-top:12px;
    }

    .pill-link{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:12px 12px;
      border-radius:16px;
      background:rgba(3,78,162,.05);
      border:1px solid rgba(3,78,162,.12);
      font-weight:900;
      color:#0f2f62;
    }

    .pill-link:hover{ background:rgba(3,78,162,.08); }

    .pill-link span{
      opacity:.9;
      font-weight:700;
      color:#162b55;
      font-size:13px;
    }

    /* ===== WEATHER (same as Quito) ===== */
    .wx-card{
      padding:18px 18px;
      border-radius:22px;
      background:#fff;
      box-shadow:0 18px 55px rgba(3,78,162,.12);
      border:1px solid rgba(0,0,0,.06);
    }

    .wx-title{
      margin:0 0 8px;
      font-family:Montserrat,Inter,sans-serif;
      font-weight:800;
      letter-spacing:-0.02em;
      font-size:16px;
      color:#0f2f62;
    }

    .wx-now{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      padding:14px 14px;
      border-radius:18px;
      background:linear-gradient(180deg, rgba(3,78,162,.045), rgba(3,78,162,.02));
      border:1px solid rgba(3,78,162,.12);
    }

    .wx-date{
      font-weight:900;
      color:#0f2f62;
      letter-spacing:-0.01em;
      font-size:13.2px;
      opacity:.95;
      white-space:nowrap;
      margin-top:2px;
    }

    .wx-lines{
      margin:0;
      color:#1f2b3f;
      line-height:1.55;
      font-size:13.8px;
      opacity:.95;
      text-align:right;
    }

    .wx-grid7{
      display:grid;
      grid-template-columns:repeat(3, 1fr);
      gap:10px;
      margin-top:12px;
    }

    .wx-day{
      border-radius:16px;
      padding:10px 10px;
      background:rgba(255,255,255,.9);
      border:1px solid rgba(3,78,162,.14);
      text-align:left;
    }

    .wx-top{
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap:8px;
    }

    .wx-dow{
      font-weight:900;
      color:#0f2f62;
      font-size:12.5px;
      letter-spacing:-0.01em;
    }

    .wx-mmdd{
      color:#162b55;
      opacity:.75;
      font-size:11.5px;
    }

    .wx-hi{
      margin-top:8px;
      font-weight:900;
      color:#0f2f62;
      font-size:12.8px;
    }

    .wx-lo{
      color:#162b55;
      opacity:.8;
      font-size:12.3px;
      margin-top:2px;
    }

    .wx-rain{
      margin-top:6px;
      color:#162b55;
      opacity:.85;
      font-size:11.7px;
      white-space:nowrap;
    }

    @media(max-width:980px){
      .wx-grid7{ grid-template-columns:repeat(2, 1fr); }
    }

    .months{
      margin-top:14px;
      padding-top:14px;
      border-top:1px solid rgba(0,0,0,.06);
    }

    .wx-sub{
      margin:0 0 10px;
      color:#1f2b3f;
      opacity:.85;
      font-size:13.5px;
      line-height:1.5;
    }

    .legend{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-top:10px;
      align-items:center;
    }

    .legend-item{
      display:flex;
      align-items:center;
      gap:8px;
      font-size:12.8px;
      font-weight:800;
      color:#162b55;
      opacity:.9;
    }

    .swatch{
      width:14px;
      height:14px;
      border-radius:6px;
      border:1px solid rgba(3,78,162,.22);
      background:rgba(3,78,162,.06);
    }

    .swatch.best{ background:rgba(3,78,162,.14); border-color:rgba(3,78,162,.32); }
    .swatch.good{ background:rgba(3,78,162,.09); border-color:rgba(3,78,162,.22); }
    .swatch.fair{ background:rgba(3,78,162,.04); border-color:rgba(3,78,162,.18); opacity:.85; }

    .month-row{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top:10px;
    }

    .month-chip{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:7px 10px;
      border-radius:999px;
      border:1px solid rgba(3,78,162,.14);
      background:rgba(3,78,162,.06);
      color:#0f2f62;
      font-weight:900;
      font-size:12.4px;
      min-width:46px;
    }

    .month-chip.best{
      background:rgba(3,78,162,.14);
      border-color:rgba(3,78,162,.32);
    }

    .month-chip.good{
      background:rgba(3,78,162,.09);
      border-color:rgba(3,78,162,.22);
    }

    .month-chip.fair{
      background:rgba(3,78,162,.04);
      border-color:rgba(3,78,162,.18);
      opacity:.85;
    }

    /* ===== MORE ANDES DESTINATIONS (structure/classes locked for tiles) ===== */
    .andes-grid{
      display:grid;
      grid-template-columns:1fr;
      gap:10px;
      margin-top:12px;
    }

    .andes-tile{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      padding:12px 12px;
      border-radius:16px;
      background:linear-gradient(180deg, rgba(3,78,162,.045), rgba(3,78,162,.02));
      border:1px solid rgba(3,78,162,.12);
      transition:transform .12s ease, background .12s ease;
    }

    .andes-tile:hover{
      background:rgba(3,78,162,.07);
      transform:translateY(-1px);
    }

    .andes-left{
      display:flex;
      flex-direction:column;
      gap:4px;
      min-width:0;
    }

    .andes-title{
      font-weight:900;
      color:#0f2f62;
      font-size:14.8px;
      letter-spacing:-0.01em;
      line-height:1.2;
    }

    .andes-sub{
      color:#1f2b3f;
      opacity:.9;
      line-height:1.5;
      font-size:13.4px;
      max-width:60ch;
    }

    .andes-arrow{
      flex:0 0 auto;
      width:34px;
      height:34px;
      border-radius:999px;
      border:1px solid rgba(3,78,162,.18);
      background:rgba(255,255,255,.75);
      display:flex;
      align-items:center;
      justify-content:center;
      margin-top:2px;
    }

    .andes-arrow span{
      display:block;
      width:10px;
      height:10px;
      border-right:2px solid #0f2f62;
      border-bottom:2px solid #0f2f62;
      transform:rotate(-45deg);
      opacity:.85;
    }

    /* ===== CAROUSEL (LEFT COLUMN) ===== */
    .carousel{
      margin-top:18px;
      background:#fff;
      border-radius:22px;
      border:1px solid rgba(0,0,0,0.06);
      box-shadow:0 18px 55px rgba(3,78,162,0.10);
      overflow:hidden;
      position:relative;
      z-index:1;
    }

    .carousel-viewport{
      overflow:hidden;
      width:100%;
      touch-action:pan-y;
    }

    .carousel-track{
      display:flex;
      width:100%;
      transform:translateX(0);
      transition:transform 450ms ease;
      will-change:transform;
    }

    .carousel-slide{
      min-width:100%;
      position:relative;
      aspect-ratio:16/9;
      background:#eef2f7;
    }

    .carousel-slide img{
      width:100%;
      height:100%;
      object-fit:cover;
    }

    .carousel-btn{
      position:absolute;
      top:50%;
      transform:translateY(-50%);
      width:44px;
      height:44px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.35);
      background:rgba(15,47,98,0.55);
      backdrop-filter:blur(10px);
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:5;
    }

    .carousel-btn:hover{ background:rgba(15,47,98,0.70); }

    .carousel-btn.prev{ left:12px; }
    .carousel-btn.next{ right:12px; }

    .carousel-btn span{
      display:block;
      width:10px;
      height:10px;
      border-right:2px solid #fff;
      border-bottom:2px solid #fff;
      opacity:.95;
    }

    .carousel-btn.prev span{ transform:rotate(135deg); }
    .carousel-btn.next span{ transform:rotate(-45deg); }

    .carousel-ui{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:12px 14px;
      border-top:1px solid rgba(0,0,0,0.06);
      background:linear-gradient(180deg, rgba(3,78,162,0.03), rgba(3,78,162,0.01));
    }

    .carousel-dots{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
    }

    .dot{
      width:10px;
      height:10px;
      border-radius:999px;
      border:1px solid rgba(3,78,162,0.25);
      background:rgba(3,78,162,0.12);
      cursor:pointer;
      padding:0;
    }

    .dot.active{
      background:rgba(3,78,162,0.85);
      border-color:rgba(3,78,162,0.85);
    }

    .carousel-counter{
      font-weight:700;
      font-size:13px;
      color:#0f2f62;
      opacity:.9;
      white-space:nowrap;
    }

    /* ===== MOBILE ===== */
    @media(max-width:980px){
      .content-grid{grid-template-columns:1fr}
    }

    @media(max-width:820px){
      .two-col{grid-template-columns:1fr}
    }

    @media(max-width:480px){
      .carousel-btn{ width:40px; height:40px; }
    }
  </style>
</head>

<body>
  <div id="siteHeader"></div>

  <main>
    <div class="wrap">
      <h1>Misahuallí</h1>
      <p class="lede">
        Misahuallí is a small river town that makes the Amazon feel approachable.
        It is close enough to Tena for easy day trips, but it has its own relaxed jungle vibe with riverfront walks, cultural experiences, and family-friendly activities.
        If you want an “easy intro” to the Amazon without committing to a deep-remote itinerary, Misahuallí is a great add-on.
      </p>

      <div class="meta-row" aria-label="Misahuallí overview metadata">
        <span class="pill">Region: Amazon</span>
        <span class="pill">Best For: Families, Cultural Experiences, Easy Amazon Intro</span>
        <span class="pill">Typical Time: 1–3 Days</span>
      </div>

      <section class="content-grid" aria-label="Misahuallí content">
        <!-- LEFT COLUMN -->
        <div>
          <div class="card">
            <h2>What Misahuallí Is Best For</h2>
            <p>
              Misahuallí is best for a relaxed Amazon entry point.
              You can keep your trip light and comfortable while still getting river views, jungle atmosphere, and meaningful local culture.
              It also works well for families because you can do simple activities, short outings, and wildlife-focused stops without long transfers.
            </p>

            <div class="two-col" aria-label="Misahuallí highlights">
              <div class="mini-card">
                <h3>Small River Town Base</h3>
                <p>
                  A calm place to slow down and enjoy the Amazon rhythm.
                </p>
              </div>

              <div class="mini-card">
                <h3>Wildlife Rescue Centers Nearby</h3>
                <p>
                  Great for educational visits and gentle wildlife experiences.
                </p>
              </div>

              <div class="mini-card">
                <h3>Relaxed Jungle Vibe</h3>
                <p>
                  Riverfront time, short walks, and low-pressure exploration.
                </p>
              </div>

              <div class="mini-card">
                <h3>Easy Amazon Intro</h3>
                <p>
                  Ideal if you want “Amazon feel” without complex logistics.
                </p>
              </div>
            </div>

            <div class="chips" aria-label="Misahuallí theme chips">
              <span class="chip">Families</span>
              <span class="chip">Culture</span>
              <span class="chip">River Town</span>
              <span class="chip">Wildlife</span>
              <span class="chip">Easy Pace</span>
              <span class="chip">Day Trips</span>
            </div>
          </div>

          <div class="card">
            <h2>Simple Planning Flow</h2>
            <p>
              Start simple.
              Arrive and use your first afternoon for a riverfront walk and a relaxed local meal.
              Then choose one short wildlife-focused outing and one cultural experience that fits your pace.
            </p>
            <p>
              If you are pairing Misahuallí with Tena, keep Misahuallí as your “slow day” anchor and use Tena for your high-energy adventure day.
              If you want help building a family-friendly Amazon plan that stays easy, reach out via the
              <a class="inline-link" href="/contact/">Contact</a> page.
            </p>
          </div>

          <!-- CAROUSEL (placeholder images for now) -->
          <div id="misahualliCarousel" class="carousel" aria-label="Misahuallí image gallery">
            <button class="carousel-btn prev" type="button" aria-label="Previous image">
              <span aria-hidden="true"></span>
            </button>

            <div class="carousel-viewport">
              <div class="carousel-track">
                <div class="carousel-slide"><img src="/assets/images/EE-Carousel-Misahuallí-1.jpg" alt="Misahuallí highlight 1"></div>
                <div class="carousel-slide"><img src="/assets/images/EE-Carousel-Misahuallí-2.jpg" alt="Misahuallí highlight 2"></div>
                <div class="carousel-slide"><img src="/assets/images/EE-Carousel-Misahuallí-3.jpg" alt="Misahuallí highlight 3"></div>
                <div class="carousel-slide"><img src="/assets/images/EE-Carousel-Misahuallí-4.jpg" alt="Misahuallí highlight 4"></div>
                <div class="carousel-slide"><img src="/assets/images/EE-Carousel-Misahuallí-5.jpg" alt="Misahuallí highlight 5"></div>
                <div class="carousel-slide"><img src="/assets/images/EE-Carousel-Misahuallí-6.jpg" alt="Misahuallí highlight 6"></div>
              </div>
            </div>

            <button class="carousel-btn next" type="button" aria-label="Next image">
              <span aria-hidden="true"></span>
            </button>

            <div class="carousel-ui">
              <div class="carousel-dots" aria-label="Carousel pagination"></div>
              <div class="carousel-counter" id="misahualliCarouselCounter">1 / 6</div>
            </div>
          </div>
        </div>

        <!-- RIGHT COLUMN -->
        <aside class="side-stack" aria-label="Misahuallí side content">
          <div class="mini">
            <h3>Best Use Of Time</h3>
            <p>
              Misahuallí shines when you want the Amazon atmosphere without a packed schedule.
              If you have 1 day, make it a calm river day plus one short wildlife or cultural stop.
              If you have 2 to 3 days, add a second easy outing and keep your afternoons flexible for weather and rest.
            </p>

            <div class="link-list" aria-label="Quick links">
              <a class="pill-link" href="/regions/amazon/">
                Back to Amazon <span>Region Page</span>
              </a>
              <a class="pill-link" href="/regions/amazon/misahualli/">
                Misahuallí <span>Easy Amazon Intro</span>
              </a>
              <a class="pill-link" href="/contact/">
                Contact <span>Questions and Partnerships</span>
              </a>
            </div>
          </div>

          <!-- Weather card (same behavior as Quito) -->
          <div class="wx-card" aria-label="Weather and seasonality">
            <div class="wx-title">Current Weather</div>

            <div class="wx-now">
              <div class="wx-date" id="misahualliWxDate">--/--/----</div>
              <p class="wx-lines" id="misahualliWxLines">Loading…</p>
            </div>

            <div class="months" aria-label="Forecast and best months section">
              <div class="wx-title" style="margin-top:0;">7-Day Forecast</div>
              <div class="wx-sub">High / low and rain for the week ahead.</div>
              <div class="wx-grid7" id="misahualliWx7" aria-label="Misahuallí 7-day forecast grid"></div>

              <div class="wx-title" style="margin-top:14px;">Best Months To Visit</div>
              <div class="wx-sub" style="margin-bottom:8px;">
                Based on typically drier stretches and comfortable outdoor conditions.
              </div>

              <div class="legend" aria-label="Best months legend">
                <div class="legend-item"><span class="swatch best" aria-hidden="true"></span>Best</div>
                <div class="legend-item"><span class="swatch good" aria-hidden="true"></span>Good</div>
                <div class="legend-item"><span class="swatch fair" aria-hidden="true"></span>Fair</div>
              </div>

              <div class="month-row" aria-label="12-month seasonality chips">
                <span class="month-chip fair" aria-label="January">Jan</span>
                <span class="month-chip fair" aria-label="February">Feb</span>
                <span class="month-chip good" aria-label="March good month">Mar</span>
                <span class="month-chip good" aria-label="April good month">Apr</span>
                <span class="month-chip good" aria-label="May good month">May</span>
                <span class="month-chip best" aria-label="June best month">Jun</span>
                <span class="month-chip best" aria-label="July best month">Jul</span>
                <span class="month-chip best" aria-label="August best month">Aug</span>
                <span class="month-chip best" aria-label="September best month">Sep</span>
                <span class="month-chip good" aria-label="October good month">Oct</span>
                <span class="month-chip fair" aria-label="November">Nov</span>
                <span class="month-chip fair" aria-label="December">Dec</span>
              </div>
            </div>
          </div>

          <div class="mini">
            <h3>More Amazon Destinations</h3>
            <p>
              Use one main base for the Amazon, then add quieter stops to balance your trip.
            </p>

            <div class="andes-grid" aria-label="Amazon destination links">
              <a class="andes-tile" href="/regions/amazon/tena/" aria-label="Open Tena page">
                <div class="andes-left">
                  <div class="andes-title">Tena</div>
                  <div class="andes-sub">The main gateway base with rafting and flexible jungle access.</div>
                </div>
                <div class="andes-arrow" aria-hidden="true"><span></span></div>
              </a>

              <a class="andes-tile" href="/regions/amazon/yasuni-national-park/" aria-label="Open Yasuní National Park page">
                <div class="andes-left">
                  <div class="andes-title">Yasuní National Park</div>
                  <div class="andes-sub">Deep Amazon immersion with guided lodge-based exploration.</div>
                </div>
                <div class="andes-arrow" aria-hidden="true"><span></span></div>
              </a>

              <a class="andes-tile" href="/regions/amazon/cuyabeno-wildlife-reserve/" aria-label="Open Cuyabeno Wildlife Reserve page">
                <div class="andes-left">
                  <div class="andes-title">Cuaybeno Wildlife Reserve</div>
                  <div class="andes-sub">Lagoon system, canoe exploration, excellent wildlife sightings.</div>
                </div>
                <div class="andes-arrow" aria-hidden="true"><span></span></div>
              </a>

              <a class="andes-tile" href="/regions/amazon/" aria-label="Open Amazon region page">
                <div class="andes-left">
                  <div class="andes-title">Amazon</div>
                  <div class="andes-sub">Explore all Amazon destinations and trip ideas.</div>
                </div>
                <div class="andes-arrow" aria-hidden="true"><span></span></div>
              </a>
            </div>
          </div>
        </aside>
      </section>
    </div>
  </main>

  <div id="siteFooter"></div>

  <script src="/assets/js/site.js"></script>

  <script>
    (function(){
      async function inject(id, url){
        const el = document.getElementById(id);
        if(!el) return;
        const res = await fetch(url, { cache: "no-store" });
        el.innerHTML = await res.text();
      }
      inject("siteHeader", "/assets/includes/header.html");
      inject("siteFooter", "/assets/includes/footer.html");
    })();
  </script>

  <script>
    /* Misahuallí carousel */
    (function(){
      const root = document.getElementById("misahualliCarousel");
      if(!root) return;

      const track = root.querySelector(".carousel-track");
      const slides = Array.from(root.querySelectorAll(".carousel-slide"));
      const prevBtn = root.querySelector(".carousel-btn.prev");
      const nextBtn = root.querySelector(".carousel-btn.next");
      const dotsWrap = root.querySelector(".carousel-dots");
      const counter = root.querySelector("#misahualliCarouselCounter");

      let index = 0;

      const AUTOPLAY_MS = 5000;
      const prefersReducedMotion = window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches;

      let autoplayTimer = null;
      let autoplayEnabled = !prefersReducedMotion;

      function setIndex(next){
        index = (next + slides.length) % slides.length;
        track.style.transform = `translateX(-${index * 100}%)`;
        updateDots();
        updateCounter();
      }

      function updateCounter(){
        if(counter) counter.textContent = `${index + 1} / ${slides.length}`;
      }

      function updateDots(){
        const dots = Array.from(dotsWrap.querySelectorAll(".dot"));
        dots.forEach((d,i) => d.classList.toggle("active", i === index));
      }

      function buildDots(){
        dotsWrap.innerHTML = "";
        slides.forEach((_, i) => {
          const b = document.createElement("button");
          b.type = "button";
          b.className = "dot" + (i === 0 ? " active" : "");
          b.setAttribute("aria-label", `Go to image ${i + 1}`);
          b.addEventListener("click", () => {
            setIndex(i);
            stopAutoplay();
          });
          dotsWrap.appendChild(b);
        });
      }

      function next(){ setIndex(index + 1); }
      function prev(){ setIndex(index - 1); }

      function startAutoplay(){
        if(!autoplayEnabled) return;
        stopAutoplay();
        autoplayTimer = setInterval(next, AUTOPLAY_MS);
      }

      function stopAutoplay(){
        if(autoplayTimer){
          clearInterval(autoplayTimer);
          autoplayTimer = null;
        }
      }

      if(prevBtn) prevBtn.addEventListener("click", () => { prev(); stopAutoplay(); });
      if(nextBtn) nextBtn.addEventListener("click", () => { next(); stopAutoplay(); });

      root.addEventListener("keydown", (e) => {
        if(e.key === "ArrowLeft"){ prev(); stopAutoplay(); }
        if(e.key === "ArrowRight"){ next(); stopAutoplay(); }
      });

      let startX = 0;
      let isDown = false;

      const viewport = root.querySelector(".carousel-viewport");
      viewport.addEventListener("pointerdown", (e) => {
        isDown = true;
        startX = e.clientX;
        viewport.setPointerCapture(e.pointerId);
      });

      viewport.addEventListener("pointerup", (e) => {
        if(!isDown) return;
        isDown = false;
        const dx = e.clientX - startX;
        const threshold = 40;
        if(dx > threshold){ prev(); stopAutoplay(); }
        if(dx < -threshold){ next(); stopAutoplay(); }
      });

      viewport.addEventListener("pointercancel", () => { isDown = false; });

      root.addEventListener("mouseenter", stopAutoplay);
      root.addEventListener("mouseleave", startAutoplay);
      root.addEventListener("focusin", stopAutoplay);
      root.addEventListener("focusout", startAutoplay);

      root.tabIndex = 0;
      buildDots();
      updateCounter();
      setIndex(0);
      startAutoplay();
    })();

    /* Misahuallí weather (Quito-style contract: /api/weather + localStorage cache + Max/Min/Rain with <br>) */
    (function(){
      const dateEl = document.getElementById("misahualliWxDate");
      const linesEl = document.getElementById("misahualliWxLines");
      const gridEl = document.getElementById("misahualliWx7");
      if(!dateEl || !linesEl || !gridEl) return;

      // Misahuallí, Ecuador (approx.)
      const LAT = -1.0350;
      const LON = -77.6680;

      const CACHE_KEY = "misahualli-wx-v1";
      const TTL_MS = 30 * 60 * 1000;

      function fmtDateMMDDYYYY(d){
        const mm = String(d.getMonth()+1).padStart(2,"0");
        const dd = String(d.getDate()).padStart(2,"0");
        const yy = d.getFullYear();
        return `${mm}/${dd}/${yy}`;
      }

      function fmtMMDD(iso){
        const d = new Date(iso + "T00:00:00");
        const mm = String(d.getMonth()+1).padStart(2,"0");
        const dd = String(d.getDate()).padStart(2,"0");
        return `${mm}/${dd}`;
      }

      function dowShort(iso){
        const d = new Date(iso + "T00:00:00");
        return d.toLocaleDateString("en-US",{ weekday:"short" });
      }

      function cToF(c){
        return Math.round((c * 9/5) + 32);
      }

      function setUnavailable(){
        dateEl.textContent = "--/--/----";
        linesEl.innerHTML = "Weather unavailable right now.";
        gridEl.innerHTML = "";
      }

      function setLoading(){
        dateEl.textContent = fmtDateMMDDYYYY(new Date());
        linesEl.innerHTML = "Loading…";
        gridEl.innerHTML = "";
      }

      function readCache(){
        try{
          const raw = localStorage.getItem(CACHE_KEY);
          if(!raw) return null;
          const obj = JSON.parse(raw);
          if(!obj || typeof obj !== "object") return null;
          if(!obj.ts || !obj.data) return null;
          if((Date.now() - obj.ts) > TTL_MS) return null;
          return obj.data;
        }catch(e){
          return null;
        }
      }

      function writeCache(data){
        try{
          localStorage.setItem(CACHE_KEY, JSON.stringify({ ts: Date.now(), data }));
        }catch(e){}
      }

      function normalize(api){
        const unitsTemp =
          (api && api.units && (api.units.temp || api.units.temperature)) ||
          (api && api.unit && api.unit.temperature) ||
          null;

        const isC =
          (typeof unitsTemp === "string" && unitsTemp.toUpperCase().includes("C")) ? true :
          (typeof unitsTemp === "string" && unitsTemp.toUpperCase().includes("F")) ? false :
          true;

        if(api && api.current && Array.isArray(api.daily)){
          const current = api.current || {};
          const dailyArr = api.daily || [];
          return {
            isC,
            current: {
              tmax: current.tmax,
              tmin: current.tmin,
              rain: current.rain
            },
            days: dailyArr.slice(0, 7).map(d => ({
              date: d.date,
              tmax: d.tmax,
              tmin: d.tmin,
              rain: d.rain
            }))
          };
        }

        const daily = (api && api.daily) ? api.daily : {};
        const days = daily.time || [];
        const tmax = daily.temperature_2m_max || [];
        const tmin = daily.temperature_2m_min || [];
        const rain = daily.precipitation_probability_max || [];

        return {
          isC,
          current: {
            tmax: (typeof tmax[0] === "number" ? tmax[0] : null),
            tmin: (typeof tmin[0] === "number" ? tmin[0] : null),
            rain: (typeof rain[0] === "number" ? rain[0] : null)
          },
          days: days.slice(0, 7).map((iso, i) => ({
            date: iso,
            tmax: tmax[i],
            tmin: tmin[i],
            rain: rain[i]
          }))
        };
      }

      function render(norm){
        dateEl.textContent = fmtDateMMDDYYYY(new Date());

        const tmax = norm.current.tmax;
        const tmin = norm.current.tmin;
        const rain = norm.current.rain;

        const maxStr = (typeof tmax === "number")
          ? `Max: ${norm.isC ? cToF(tmax) : Math.round(tmax)}°F`
          : "Max: --";
        const minStr = (typeof tmin === "number")
          ? `Min: ${norm.isC ? cToF(tmin) : Math.round(tmin)}°F`
          : "Min: --";
        const rainStr = (typeof rain === "number")
          ? `Rain: ${Math.round(rain)}%`
          : "Rain: --";

        linesEl.innerHTML = `${maxStr}<br>${minStr}<br>${rainStr}`;

        gridEl.innerHTML = "";
        const count = Math.min(7, norm.days.length);

        for(let i=0; i<count; i++){
          const d = norm.days[i] || {};
          const dayIso = d.date;

          const hi = d.tmax;
          const lo = d.tmin;
          const r = d.rain;

          const card = document.createElement("div");
          card.className = "wx-day";

          const top = document.createElement("div");
          top.className = "wx-top";

          const dow = document.createElement("div");
          dow.className = "wx-dow";
          dow.textContent = dayIso ? dowShort(dayIso) : "--";

          const mmdd = document.createElement("div");
          mmdd.className = "wx-mmdd";
          mmdd.textContent = dayIso ? fmtMMDD(dayIso) : "--/--";

          top.appendChild(dow);
          top.appendChild(mmdd);

          const hiEl = document.createElement("div");
          hiEl.className = "wx-hi";
          hiEl.textContent = (typeof hi === "number")
            ? `High ${norm.isC ? cToF(hi) : Math.round(hi)}°F`
            : "High --";

          const loEl = document.createElement("div");
          loEl.className = "wx-lo";
          loEl.textContent = (typeof lo === "number")
            ? `Low ${norm.isC ? cToF(lo) : Math.round(lo)}°F`
            : "Low --";

          const rainEl = document.createElement("div");
          rainEl.className = "wx-rain";
          rainEl.textContent = (typeof r === "number")
            ? `Rain ${Math.round(r)}%`
            : "Rain --";

          card.appendChild(top);
          card.appendChild(hiEl);
          card.appendChild(loEl);
          card.appendChild(rainEl);

          gridEl.appendChild(card);
        }
      }

      async function load(){
        setLoading();

        const cached = readCache();
        if(cached){
          try{
            render(normalize(cached));
            return;
          }catch(e){}
        }

        try{
          const url = `/api/weather?lat=${encodeURIComponent(LAT)}&lon=${encodeURIComponent(LON)}`;
          const res = await fetch(url, { cache: "no-store" });
          if(!res.ok) throw new Error("Weather fetch failed");
          const data = await res.json();

          writeCache(data);
          render(normalize(data));
        }catch(e){
          setUnavailable();
        }
      }

      load();
    })();

    // Light deterrent: disable right-click on images only
    document.addEventListener('contextmenu', (e) => {
      if (e.target && e.target.tagName === 'IMG') e.preventDefault();
    });
  </script>
</body>
</html>
