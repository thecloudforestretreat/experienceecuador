<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Partner Application | Experience Ecuador</title>
  <meta name="description" content="Apply to be featured as a recommended partner on Experience Ecuador. Submit your business details, regions, locations, and experiences." />
  <meta name="robots" content="index,follow" />
  <link rel="canonical" href="https://experienceecuador.com/partners/join/" />

  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Experience Ecuador" />
  <meta property="og:title" content="Partner Application | Experience Ecuador" />
  <meta property="og:description" content="Submit your partner application to be considered for Recommended by Experience Ecuador." />
  <meta property="og:url" content="https://experienceecuador.com/partners/join/" />
  <meta property="og:image" content="https://experienceecuador.com/assets/images/EE-OG-Image-1.jpg" />

  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Partner Application | Experience Ecuador" />
  <meta name="twitter:description" content="Apply to be featured as a recommended partner on Experience Ecuador." />
  <meta name="twitter:image" content="https://experienceecuador.com/assets/images/EE-OG-Image-1.jpg" />

  <link rel="icon" href="/favicon.ico" sizes="any" />
  <link rel="icon" href="/favicon.svg" type="image/svg+xml" />
  <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
  <link rel="manifest" href="/site.webmanifest" />
  <meta name="theme-color" content="#034EA2" />

  <link rel="stylesheet" href="/assets/css/header.css" />
  <link rel="stylesheet" href="/assets/css/footer.css" />

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800&family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />

  <style>
    :root{
      --brand:#034EA2;
      --ink:#0f2f62;
      --text:#1f2a3a;
      --muted:#6b7280;
      --bg:#f6f8fb;
      --card:#ffffff;
      --line: rgba(0,0,0,0.08);
      --shadow: 0 18px 55px rgba(3,78,162,0.12);
      --shadowSoft: 0 14px 34px rgba(3,78,162,0.10);
      --r-xl: 24px;
      --max: 1040px;
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      background: var(--bg);
    }
    a{ color: inherit; text-decoration:none; }
    .wrap{ max-width: var(--max); margin:0 auto; padding: 22px 18px 72px; }

    .topRow{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
      flex-wrap: wrap;
      margin: 10px 0 16px;
    }
    h1{
      margin:0;
      font-family: Montserrat, Inter, sans-serif;
      font-weight: 800;
      letter-spacing: -0.03em;
      color: var(--brand);
      font-size: 30px;
      line-height: 1.1;
    }
    .sub{
      margin: 8px 0 0;
      color: var(--muted);
      line-height: 1.6;
      font-weight: 600;
      max-width: 86ch;
      font-size: 14px;
    }

    .toggle{
      display:inline-flex;
      align-items:center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(3,78,162,0.18);
      background: rgba(255,255,255,0.92);
      color: var(--ink);
      font-weight: 900;
      font-size: 12.5px;
      user-select:none;
      box-shadow: var(--shadowSoft);
    }
    .switch{
      width: 46px;
      height: 28px;
      border-radius: 999px;
      background: rgba(3,78,162,0.14);
      position: relative;
      cursor: pointer;
      border: 1px solid rgba(3,78,162,0.18);
      flex: 0 0 auto;
    }
    .knob{
      position:absolute;
      top: 3px;
      left: 3px;
      width: 22px;
      height: 22px;
      border-radius: 999px;
      background: #fff;
      box-shadow: 0 10px 22px rgba(0,0,0,0.10);
      transition: transform 180ms ease;
    }
    .switch.is-en .knob{ transform: translateX(18px); }

    .card{
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--r-xl);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .pad{ padding: 16px; }

    .row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 12px;
    }
    .row.one{ grid-template-columns: 1fr; }

    label{
      display:block;
      font-weight: 900;
      font-size: 12.5px;
      color: var(--ink);
      margin: 0 0 6px;
    }
    .req{ color:#b91c1c; margin-right:6px; }
    input, textarea, select{
      width:100%;
      border:1px solid rgba(3,78,162,0.18);
      border-radius: 14px;
      padding: 11px 12px;
      font-size: 14px;
      outline: none;
      background: rgba(255,255,255,0.98);
    }
    textarea{ min-height: 96px; resize: vertical; }

    .help{
      font-size: 12px;
      color: var(--muted);
      font-weight: 650;
      margin-top: 6px;
      line-height: 1.5;
    }

    .pillBox{
      border:1px solid rgba(3,78,162,0.18);
      border-radius: 14px;
      padding: 10px;
      background: rgba(3,78,162,0.03);
      display:flex;
      flex-wrap: wrap;
      gap: 10px;
      max-height: 220px;
      overflow:auto;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 8px 10px;
      border-radius: 999px;
      border:1px solid rgba(3,78,162,0.18);
      background: rgba(255,255,255,0.92);
      font-weight: 900;
      font-size: 12.5px;
      color: var(--ink);
      cursor: pointer;
      user-select:none;
      white-space: nowrap;
    }
    .pill input{ width:auto; margin:0; }

    .uploadBand{
      border-radius: 16px;
      border: 1px solid rgba(3,78,162,0.18);
      background: rgba(3,78,162,0.04);
      padding: 12px;
      margin-top: 10px;
    }
    .uploadBand strong{ color: var(--ink); }
    .uploadRow{ display:flex; gap: 10px; flex-wrap: wrap; align-items:center; margin-top: 8px; }
    .btnLink{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding: 10px 12px;
      border-radius: 14px;
      font-weight: 900;
      border: 1px solid rgba(3,78,162,0.18);
      background: rgba(255,255,255,0.96);
      color: var(--ink);
      box-shadow: var(--shadowSoft);
    }

    .consentRow{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
      padding: 12px;
      border-radius: 14px;
      border:1px solid rgba(3,78,162,0.18);
      background: rgba(255,255,255,0.92);
    }
    .consentRow label{ margin:0; font-size:12.8px; line-height:1.5; font-weight:900; color: var(--ink); }
    .consentRow input{ width:auto; margin-top: 2px; }

    .okBox, .errBox{
      margin-top: 14px;
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid rgba(0,0,0,0.08);
      background: rgba(255,255,255,0.92);
      font-weight: 800;
      display:none;
      line-height: 1.55;
      font-size: 13px;
    }
    .okBox{ border-color: rgba(16,185,129,0.35); }
    .errBox{ border-color: rgba(239,68,68,0.35); }

    .actions{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      flex-wrap: wrap;
      padding: 16px;
      border-top: 1px solid var(--line);
      background: rgba(3,78,162,0.02);
    }
    .note{ font-weight: 800; color: var(--ink); font-size: 12.5px; line-height: 1.45; max-width: 66ch; }
    .btnRow{ display:flex; gap: 10px; flex-wrap: wrap; align-items:center; }
    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding: 12px 14px;
      border-radius: 14px;
      font-weight: 900;
      border: 1px solid rgba(3,78,162,0.18);
      background: rgba(255,255,255,0.96);
      color: var(--ink);
      cursor:pointer;
      box-shadow: var(--shadowSoft);
    }
    .btn.primary{
      background: rgba(3,78,162,0.95);
      color:#fff;
      border-color: rgba(3,78,162,0.28);
      box-shadow: 0 18px 40px rgba(3,78,162,0.18);
    }
    .btn:disabled{ opacity:.65; cursor: default; }

    @media (max-width: 900px){
      .wrap{ padding: 18px 14px 64px; }
      .row{ grid-template-columns: 1fr; }
      .note{ max-width:none; }
    }
  </style>
</head>
<body>
  <div id="siteHeader"></div>

  <main class="wrap" aria-label="Partner application">
    <div class="topRow">
      <div>
        <h1 data-i18n="title">Partner Application</h1>
        <p class="sub" data-i18n="subtitle">Submit your details to be considered for Recommended by Experience Ecuador.</p>
      </div>

      <div class="toggle" aria-label="Language toggle">
        <span>ES</span>
        <div class="switch is-en" id="langSwitch" role="button" tabindex="0" aria-label="Toggle language">
          <div class="knob"></div>
        </div>
        <span>EN</span>
      </div>
    </div>

    <section class="card" aria-label="Partner form">
      <div class="pad">
        <form id="eeForm" autocomplete="on">
          <input type="hidden" name="language" id="language" value="en" />
          <input type="hidden" name="drive_upload_link" id="drive_upload_link" value="https://docs.google.com/forms/d/e/1FAIpQLSf4bTVL36AFYwK1WUyPZbYvkJ891VYnYQrh1VaibIsMCKwEbA/viewform?usp=sharing" />
          <input type="hidden" name="source_page" id="source_page" value="https://experienceecuador.com/partners/join/" />

          <div class="row">
            <div>
              <label><span class="req">*</span><span data-i18n="business_name_label">Business name</span></label>
              <input name="business_name" id="business_name" placeholder="Mindo Bird Watching" required />
            </div>
            <div>
              <label><span class="req">*</span><span data-i18n="business_type_label">Category</span></label>
              <select name="business_type" id="business_type" required></select>
              <div class="help" data-i18n="business_type_help">Choose one.</div>
            </div>
          </div>

          <div class="row">
            <div>
              <label><span class="req">*</span><span data-i18n="email_label">Business email</span></label>
              <input name="email" id="email" type="email" placeholder="hello@example.com" required />
            </div>
            <div>
              <label><span data-i18n="phone_label">Phone (optional)</span></label>
              <input name="phone" id="phone" placeholder="+593 ..." />
            </div>
          </div>

          <div class="row">
            <div>
              <label><span class="req">*</span><span data-i18n="website_label">Website URL</span></label>
              <input name="website_url" id="website_url" placeholder="https://example.com" required />
            </div>
            <div>
              <label><span data-i18n="whatsapp_label">WhatsApp URL (optional)</span></label>
              <input name="whatsapp_url" id="whatsapp_url" placeholder="https://wa.me/..." />
            </div>
          </div>

          <div class="row">
            <div>
              <label><span data-i18n="photos_label">Photos</span></label>

              <div class="uploadBand">
                <div><strong data-i18n="photos_upload_title">Option A: Upload images</strong></div>
                <div class="help" data-i18n="photos_upload_help">
                  If you have a Google account, you can upload images using our upload form. Google requires sign-in for file uploads.
                </div>
                <div class="uploadRow">
                  <a class="btnLink" href="https://docs.google.com/forms/d/e/1FAIpQLSf4bTVL36AFYwK1WUyPZbYvkJ891VYnYQrh1VaibIsMCKwEbA/viewform?usp=sharing" target="_blank" rel="noopener" data-i18n="open_upload_form">Open upload form</a>
                </div>
              </div>

              <div style="margin-top:10px">
                <div class="help" data-i18n="photos_urls_help">
                  Option B: If you already have direct image URLs, you can paste them here (optional).
                </div>
                <input name="image_1_url" id="image_1_url" placeholder="Image URL 1" style="margin-top:8px" />
                <input name="image_2_url" id="image_2_url" placeholder="Image URL 2" style="margin-top:10px" />
                <input name="image_3_url" id="image_3_url" placeholder="Image URL 3" style="margin-top:10px" />
              </div>

              <div class="help" data-i18n="photos_fallback">
                Option C: If neither works, you can email images to info@experienceecuador.com.
              </div>
            </div>

            <div>
              <label><span class="req">*</span><span data-i18n="regions_label">Regions</span></label>
              <div class="pillBox" id="regionsBox"></div>
              <div class="help" data-i18n="regions_help">Select all that apply.</div>

              <div style="margin-top:12px">
                <label><span class="req">*</span><span data-i18n="locations_label">Locations</span></label>
                <div class="pillBox" id="locationsBox"></div>
                <div class="help" data-i18n="locations_help">Locations update based on selected regions.</div>
              </div>
            </div>
          </div>

          <div class="row one">
            <div>
              <label><span class="req">*</span><span data-i18n="experiences_label">Experiences</span></label>
              <div class="pillBox" id="experiencesBox"></div>
              <div class="help" data-i18n="experiences_help">Select all that apply.</div>
            </div>
          </div>

          <div class="row">
            <div>
              <label><span class="req">*</span><span data-i18n="desc_es_label">Short description (Spanish)</span></label>
              <textarea name="short_description_es" id="short_description_es" placeholder="Describe tu negocio en 2 a 5 frases." required></textarea>
            </div>
            <div>
              <label><span data-i18n="desc_en_label">Short description (English)</span></label>
              <textarea name="short_description_en" id="short_description_en" placeholder="Describe your business in 2 to 5 sentences."></textarea>
            </div>
          </div>

          <div class="row one" style="margin-top:14px">
            <div class="consentRow">
              <label><span class="req">*</span><span data-i18n="consent_publish_label">I confirm you may publish these details on Experience Ecuador.</span></label>
              <input name="consent_publish" id="consent_publish" type="checkbox" value="yes" required />
            </div>

            <div class="consentRow" style="margin-top:10px">
              <label><span class="req">*</span><span data-i18n="consent_contact_label">I agree Experience Ecuador may contact me about my submission.</span></label>
              <input name="consent_contact" id="consent_contact" type="checkbox" value="yes" required />
            </div>
          </div>

          <div class="okBox" id="okBox"></div>
          <div class="errBox" id="errBox"></div>
        </form>
      </div>

      <div class="actions">
        <div class="note" data-i18n="note">Submissions are reviewed before publishing. No public prices are displayed.</div>
        <div class="btnRow">
          <button class="btn" id="btnReset" type="button" data-i18n="reset">Reset</button>
          <button class="btn primary" id="btnSubmit" type="button" data-i18n="submit">Submit</button>
        </div>
      </div>
    </section>
  </main>

  <div id="siteFooter"></div>

  <script src="/assets/js/site.js"></script>
  <script>
    (function(){
      async function inject(id, url){
        var el = document.getElementById(id);
        if(!el) return;
        var res = await fetch(url, { cache: "no-store" });
        el.innerHTML = await res.text();
      }
      inject("siteHeader", "/assets/includes/header.html");
      inject("siteFooter", "/assets/includes/footer.html");
    })();
  </script>

  <script>
    (function(){
      var API_URL = "https://script.google.com/macros/s/AKfycbyRKvcA3pKXEwA6rJS6TIqiG9AGzhNFaAX_MTKKZ12nf_XyrpCc-O5S5nOGfo2C1QEcTw/exec";
      var REGIONS_URL = "/assets/data/regions.json";
      var EXPERIENCES_URL = "/assets/data/experiences.json";

      function qs(sel, root){ return (root||document).querySelector(sel); }
      function qsa(sel, root){ return Array.prototype.slice.call((root||document).querySelectorAll(sel)); }
      function esc(s){ return String(s||"").replace(/[&<>"']/g, function(m){ return ({ "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;" })[m]; }); }
      function getParam(name){ try{ return new URL(window.location.href).searchParams.get(name); }catch(e){ return null; } }

      var init = (getParam("lang") || "").toLowerCase().trim();
      var lang = (init === "es") ? "es" : "en";

      var STR = {
        en: {
          title: "Partner Application",
          subtitle: "Submit your details to be considered for Recommended by Experience Ecuador.",
          business_name_label: "Business name",
          business_type_label: "Category",
          business_type_help: "Choose one.",
          email_label: "Business email",
          phone_label: "Phone (optional)",
          website_label: "Website URL",
          whatsapp_label: "WhatsApp URL (optional)",
          photos_label: "Photos",
          photos_upload_title: "Option A: Upload images",
          photos_upload_help: "If you have a Google account, you can upload images using our upload form. Google requires sign-in for file uploads.",
          open_upload_form: "Open upload form",
          photos_urls_help: "Option B: If you already have direct image URLs, you can paste them here (optional).",
          photos_fallback: "Option C: If neither works, you can email images to info@experienceecuador.com.",
          regions_label: "Regions",
          regions_help: "Select all that apply.",
          locations_label: "Locations",
          locations_help: "Locations update based on selected regions.",
          experiences_label: "Experiences",
          experiences_help: "Select all that apply.",
          desc_es_label: "Short description (Spanish)",
          desc_en_label: "Short description (English)",
          consent_publish_label: "I confirm you may publish these details on Experience Ecuador.",
          consent_contact_label: "I agree Experience Ecuador may contact me about my submission.",
          note: "Submissions are reviewed before publishing. No public prices are displayed.",
          reset: "Reset",
          submit: "Submit",
          submitting: "Submitting...",
          select: "Select",
          required_missing: "Please complete all required fields marked with *.",
          load_failed: "We could not load regions/experiences. Please refresh the page.",
          success: "Submitted. Thanks. We received your application and sent a confirmation email."
        },
        es: {
          title: "Registro de Socios",
          subtitle: "Envianos tu informacion para ser considerado en Recomendado por Experience Ecuador.",
          business_name_label: "Nombre del negocio",
          business_type_label: "Categoria",
          business_type_help: "Elige una.",
          email_label: "Correo del negocio",
          phone_label: "Telefono (opcional)",
          website_label: "Sitio web",
          whatsapp_label: "WhatsApp (opcional)",
          photos_label: "Fotos",
          photos_upload_title: "Opcion A: Subir imagenes",
          photos_upload_help: "Si tienes cuenta de Google, puedes subir imagenes con nuestro formulario. Google requiere iniciar sesion para subir archivos.",
          open_upload_form: "Abrir formulario de carga",
          photos_urls_help: "Opcion B: Si ya tienes enlaces directos a imagenes, puedes pegarlos aqui (opcional).",
          photos_fallback: "Opcion C: Si ninguna opcion sirve, puedes enviarlas por correo a info@experienceecuador.com.",
          regions_label: "Regiones",
          regions_help: "Selecciona todas las que correspondan.",
          locations_label: "Ubicaciones",
          locations_help: "Las ubicaciones se actualizan segun las regiones seleccionadas.",
          experiences_label: "Experiencias",
          experiences_help: "Selecciona todas las que correspondan.",
          desc_es_label: "Descripcion corta (espanol)",
          desc_en_label: "Descripcion corta (ingles)",
          consent_publish_label: "Confirmo que pueden publicar esta informacion en Experience Ecuador.",
          consent_contact_label: "Acepto que Experience Ecuador me contacte sobre esta solicitud.",
          note: "Revisamos cada solicitud antes de publicar. No mostramos precios publicamente.",
          reset: "Limpiar",
          submit: "Enviar",
          submitting: "Enviando...",
          select: "Selecciona",
          required_missing: "Completa los campos obligatorios marcados con *.",
          load_failed: "No pudimos cargar regiones/experiencias. Actualiza la pagina.",
          success: "Enviado. Gracias. Recibimos tu solicitud y enviamos un correo de confirmacion."
        }
      };

      var BUSINESS_TYPES = [
        { id: "lodging", en: "Lodging", es: "Alojamiento" },
        { id: "restaurants", en: "Restaurants", es: "Restaurantes" },
        { id: "services", en: "Services", es: "Servicios" },
        { id: "activities", en: "Activities", es: "Actividades" }
      ];

      var regionsList = [];
      var experiencesList = [];

      function t(k){ return (STR[lang] && STR[lang][k]) ? STR[lang][k] : k; }

      function setText(){
        document.documentElement.lang = lang;
        qs("#language").value = lang;
        qs("#langSwitch").classList.toggle("is-en", lang === "en");
        qsa("[data-i18n]").forEach(function(el){
          var key = el.getAttribute("data-i18n");
          if(key) el.textContent = t(key);
        });
      }

      function renderBusinessTypes(){
        var sel = qs("#business_type");
        var current = sel.value || "";
        var opts = ['<option value="">' + esc(t("select")) + '</option>'];
        BUSINESS_TYPES.forEach(function(bt){
          var label = (lang === "es") ? bt.es : bt.en;
          opts.push('<option value="' + esc(bt.id) + '">' + esc(label) + '</option>');
        });
        sel.innerHTML = opts.join("");
        if(current) sel.value = current;
      }

      function pill(id, label, name, value, checked){
        var safeId = name + "_" + id;
        return '<label class="pill" for="' + safeId + '"><input id="' + safeId + '" type="checkbox" name="' + name + '" value="' + esc(value) + '"' + (checked ? " checked" : "") + '><span>' + esc(label) + '</span></label>';
      }

      function getChecked(name){
        return qsa('input[type="checkbox"][name="' + name + '"]:checked').map(function(x){ return (x.value||"").trim(); }).filter(Boolean);
      }

      function regionLabel(r){ return (lang === "es") ? (r.name_es || r.name_en || r.name || r.id) : (r.name_en || r.name_es || r.name || r.id); }
      function locationLabel(l){ return (lang === "es") ? (l.name_es || l.name_en || l.name || l.id) : (l.name_en || l.name_es || l.name || l.id); }
      function expLabel(e){ return (lang === "es") ? (e.name_es || e.name_en || e.name || e.id) : (e.name_en || e.name_es || e.name || e.id); }

      function renderRegions(preserve){
        var prev = preserve ? getChecked("regions") : [];
        qs("#regionsBox").innerHTML = regionsList.map(function(r){
          return pill(r.id, regionLabel(r), "regions", r.id, prev.indexOf(r.id) !== -1);
        }).join("");
      }

      function renderLocations(preserve){
        var selected = getChecked("regions");
        var prev = preserve ? getChecked("locations") : [];
        var box = qs("#locationsBox");
        if(!selected.length){ box.innerHTML = ""; return; }

        var locs = [];
        regionsList.forEach(function(r){
          if(selected.indexOf(r.id) === -1) return;
          (r.locations || []).forEach(function(l){
            locs.push({ id: l.id, label: locationLabel(l) });
          });
        });

        var seen = {};
        var uniq = [];
        locs.forEach(function(l){ if(l.id && !seen[l.id]){ seen[l.id]=true; uniq.push(l); } });

        uniq.sort(function(a,b){
          return String(a.label).localeCompare(String(b.label), (lang==="es" ? "es" : "en"), { sensitivity:"base" });
        });

        box.innerHTML = uniq.map(function(l){
          return pill(l.id, l.label, "locations", l.id, prev.indexOf(l.id) !== -1);
        }).join("");
      }

      function renderExperiences(preserve){
        var prev = preserve ? getChecked("experiences") : [];
        var exps = experiencesList.map(function(e){
          return { id: e.id, label: expLabel(e) };
        });

        exps.sort(function(a,b){
          return String(a.label).localeCompare(String(b.label), (lang==="es" ? "es" : "en"), { sensitivity:"base" });
        });

        qs("#experiencesBox").innerHTML = exps.map(function(e){
          return pill(e.id, e.label, "experiences", e.id, prev.indexOf(e.id) !== -1);
        }).join("");
      }

      function showOk(msg){
        qs("#errBox").style.display = "none";
        qs("#okBox").style.display = "block";
        qs("#okBox").textContent = msg;
      }

      function showErr(msg){
        qs("#okBox").style.display = "none";
        qs("#errBox").style.display = "block";
        qs("#errBox").textContent = msg;
      }

      function resetForm(){
        qs("#eeForm").reset();
        qs("#locationsBox").innerHTML = "";
        qs("#okBox").style.display = "none";
        qs("#errBox").style.display = "none";
        setText();
        renderBusinessTypes();
        renderRegions(false);
        renderLocations(false);
        renderExperiences(false);
      }

      function validate(){
        var bn = (qs("#business_name").value || "").trim();
        var em = (qs("#email").value || "").trim();
        var bt = (qs("#business_type").value || "").trim();
        var web = (qs("#website_url").value || "").trim();
        var regions = getChecked("regions");
        var locs = getChecked("locations");
        var exps = getChecked("experiences");
        var descEs = (qs("#short_description_es").value || "").trim();
        var c1 = qs("#consent_publish").checked;
        var c2 = qs("#consent_contact").checked;

        if(!bn || !em || !bt || !web) return false;
        if(!regions.length || !locs.length || !exps.length) return false;
        if(!descEs) return false;
        if(!c1 || !c2) return false;
        return true;
      }

      function setLang(next){
        lang = (next === "es") ? "es" : "en";
        setText();
        renderBusinessTypes();
        renderRegions(true);
        renderLocations(true);
        renderExperiences(true);
      }

      function normalizeRegionsJson_(json){
        var obj = json || {};
        var list = obj.regions || obj.Regions || obj.items || [];
        if(!Array.isArray(list)) list = [];
        return list.map(function(r){
          return {
            id: r.id,
            name_en: r.name_en,
            name_es: r.name_es,
            name: r.name,
            locations: Array.isArray(r.locations) ? r.locations : []
          };
        }).filter(function(r){ return r && r.id; });
      }

      function normalizeExperiencesJson_(json){
        var obj = json || {};
        var list = obj.experiences || obj.Experiences || obj.items || obj;
        if(!Array.isArray(list)) list = [];
        return list.map(function(e){
          return {
            id: e.id,
            name_en: e.name_en,
            name_es: e.name_es,
            name: e.name
          };
        }).filter(function(e){ return e && e.id; });
      }

      function loadData(){
        return Promise.all([
          fetch(REGIONS_URL, { cache: "no-store" }).then(function(r){ return r.json(); }),
          fetch(EXPERIENCES_URL, { cache: "no-store" }).then(function(r){ return r.json(); })
        ]).then(function(all){
          regionsList = normalizeRegionsJson_(all[0]);
          experiencesList = normalizeExperiencesJson_(all[1]);
        });
      }

      function submitAjax(){
        if(!validate()){
          showErr(t("required_missing"));
          return;
        }

        var btn = qs("#btnSubmit");
        var oldText = btn.textContent;
        btn.disabled = true;
        btn.textContent = t("submitting");

        qs("#okBox").style.display = "none";
        qs("#errBox").style.display = "none";

        var fd = new FormData(qs("#eeForm"));

        // add checkbox groups (repeated keys)
        getChecked("regions").forEach(function(v){ fd.append("regions", v); });
        getChecked("locations").forEach(function(v){ fd.append("locations", v); });
        getChecked("experiences").forEach(function(v){ fd.append("experiences", v); });

        fetch(API_URL, { method: "POST", body: fd })
          .then(function(res){ return res.json(); })
          .then(function(data){
            if(data && data.ok){
              showOk(t("success"));
              resetForm();
            } else {
              showErr((data && (data.error || data.email_error)) ? (data.error || data.email_error) : "Submission failed.");
            }
          })
          .catch(function(err){
            showErr(String(err && err.message ? err.message : err));
          })
          .finally(function(){
            btn.disabled = false;
            btn.textContent = oldText;
          });
      }

      function boot(){
        setLang(lang);

        loadData().then(function(){
          renderBusinessTypes();
          renderRegions(false);
          renderLocations(false);
          renderExperiences(false);
        }).catch(function(){
          showErr(t("load_failed"));
        });

        document.addEventListener("change", function(e){
          var tEl = e.target;
          if(tEl && tEl.name === "regions"){
            renderLocations(true);
          }
        });

        qs("#btnReset").addEventListener("click", function(){ resetForm(); });
        qs("#btnSubmit").addEventListener("click", submitAjax);

        var sw = qs("#langSwitch");
        function toggle(){ setLang(lang === "es" ? "en" : "es"); }
        sw.addEventListener("click", toggle);
        sw.addEventListener("keydown", function(e){ if(e.key === "Enter" || e.key === " "){ e.preventDefault(); toggle(); } });
      }

      boot();
    })();
  </script>
</body>
</html>
