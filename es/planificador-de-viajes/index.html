<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Planificador de Viajes | Experience Ecuador</title>
  <meta name="description" content="Crea un itinerario personalizado por Ecuador. Elige días, regiones y experiencias, y genera un itinerario sugerido." />

  <link rel="alternate" hreflang="en" href="/trip-builder/" />
  <link rel="alternate" hreflang="es" href="/es/planificador-de-viajes/" />
  <link rel="alternate" hreflang="x-default" href="/trip-builder/" />

  <!-- Favicons -->
  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="icon" href="/favicon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="manifest" href="/site.webmanifest">
  <meta name="theme-color" content="#034EA2">

  <!-- Global header/footer CSS -->
  <link rel="stylesheet" href="/assets/css/header.css">
  <link rel="stylesheet" href="/assets/css/footer.css">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --brand-blue:#034EA2;
      --charcoal:#1F1F1F;
      --slate:#6E7B8B;
      --soft:#f6f8fb;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--charcoal);
      background:var(--soft);
    }

    a{text-decoration:none;color:inherit}
    img{max-width:100%;display:block}

    /* ===== HERO ===== */
    .hero{
      position:relative;
      max-width:1100px;
      margin:0 auto;
      padding:22px 18px 12px;
    }

    .hero-banner{
      position:relative;
      border-radius:24px;
      overflow:hidden;
      box-shadow:0 22px 60px rgba(0,0,0,0.18);
      min-height:320px;
      background:
        linear-gradient(180deg, rgba(0,0,0,0.45), rgba(0,0,0,0.18)),
        url("/assets/images/EE-Assets-55-Hero-Trip-builder.jpg") center/cover no-repeat;
    }

    .hero-content{
      position:absolute;
      inset:0;
      display:flex;
      align-items:flex-end;
      padding:22px;
    }

    .hero-title{
      font-family:Montserrat,Inter,sans-serif;
      font-weight:800;
      font-size:clamp(34px,4.6vw,54px);
      letter-spacing:-0.03em;
      color:#fff;
      margin:0;
      line-height:1.05;
      text-shadow:0 10px 30px rgba(0,0,0,0.35);
    }

    /* ===== WRAP ===== */
    .wrap{
      max-width:1100px;
      margin:0 auto;
      padding:0 18px 60px;
    }

    .card{
      background:#fff;
      border-radius:22px;
      padding:22px;
      border:1px solid rgba(0,0,0,0.06);
      box-shadow:0 18px 55px rgba(3,78,162,0.12);
      min-width:0;
    }

    .card h2{
      font-family:Montserrat,Inter,sans-serif;
      font-weight:800;
      font-size:22px;
      margin:0 0 10px;
      color:var(--brand-blue);
      letter-spacing:-0.02em;
    }

    .card p{
      margin:0;
      line-height:1.75;
      font-size:15.8px;
      color:#2a2f36;
      max-width:90ch;
    }

    .section-title{
      font-family:Montserrat,Inter,sans-serif;
      font-weight:800;
      font-size:24px;
      margin:0 0 14px;
      color:var(--brand-blue);
      letter-spacing:-0.02em;
    }

    /* ===== BUILDER + FLIGHTS LAYOUT (DESKTOP) ===== */
    .builder-layout{
      margin-top:18px;
      display:grid;
      grid-template-columns: 3fr 1fr;
      gap:14px;
      align-items:stretch;
    }

    .builder-card,
    .flights-card{
      height:100%;
      display:flex;
      flex-direction:column;
      min-width:0;
    }

    /* ===== BUILDER CARD ===== */
    .builder-top{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:16px;
      flex-wrap:wrap;
    }

    .controls-grid{
      display:grid;
      grid-template-columns:auto 260px;
      gap:10px 12px;
      align-items:center;
    }

    .controls-grid label{
      font-weight:800;
      color:#0f2f62;
      font-size:13px;
      letter-spacing:0.02em;
      text-align:left;
    }

    .controls-grid select{
      appearance:none;
      -webkit-appearance:none;
      -moz-appearance:none;
      border:1px solid rgba(3,78,162,0.22);
      background:#fff;
      color:#0f2f62;
      font-weight:700;
      padding:11px 42px 11px 12px;
      border-radius:14px;
      font-size:14px;
      cursor:pointer;
      outline:none;
      min-width:0;
      width:260px;
      box-shadow:0 14px 30px rgba(3,78,162,0.10);
      background-image:
        linear-gradient(45deg, transparent 50%, #0f2f62 50%),
        linear-gradient(135deg, #0f2f62 50%, transparent 50%),
        linear-gradient(to right, transparent, transparent);
      background-position:
        calc(100% - 18px) 50%,
        calc(100% - 12px) 50%,
        0 0;
      background-size:6px 6px, 6px 6px, 100% 100%;
      background-repeat:no-repeat;
    }

    .controls-grid select:focus{
      box-shadow:0 0 0 4px rgba(3,78,162,0.16);
      border-color:rgba(3,78,162,0.45);
    }

    .pill-row{
      margin-top:14px;
      display:flex;
      flex-wrap:wrap;
      gap:10px;
    }

    .pill{
      border:1px solid rgba(3,78,162,0.16);
      background:linear-gradient(180deg, rgba(3,78,162,0.06), rgba(3,78,162,0.02));
      color:#0f2f62;
      padding:10px 12px;
      border-radius:999px;
      font-weight:800;
      font-size:13px;
      cursor:pointer;
      user-select:none;
      max-width:100%;
    }

    .pill[aria-pressed="true"]{
      background:rgba(3,78,162,0.12);
      border-color:rgba(3,78,162,0.28);
      box-shadow:0 12px 26px rgba(3,78,162,0.10);
    }

    .pill-row.experiences-grid{
      display:grid;
      grid-template-columns:repeat(3, max-content);
      gap:10px 12px;
      align-items:start;
      justify-content:start;
    }

    .region-hint{
      margin-top:10px;
      color:#24324a;
      opacity:.95;
      font-size:14.6px;
      line-height:1.55;
      white-space:normal;
      overflow-wrap:anywhere;
      word-break:break-word;
      max-width:100%;
    }

    .regions-tip{
      margin-top:8px;
      color:#24324a;
      opacity:.95;
      font-size:13.2px;
      line-height:1.45;
      max-width:90ch;
    }

    .actions{
      margin-top:18px;
      display:flex;
      gap:12px;
      flex-wrap:wrap;
    }

    .btn{
      border:1px solid rgba(3,78,162,0.22);
      background:#fff;
      color:#0f2f62;
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      font-weight:900;
      padding:12px 14px;
      border-radius:16px;
      cursor:pointer;
      box-shadow:0 14px 30px rgba(3,78,162,0.10);
      letter-spacing:-0.01em;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      white-space:nowrap;
    }

    .btn.primary{
      background:var(--brand-blue);
      color:#fff;
      border-color:rgba(3,78,162,0.35);
    }

    .btn:disabled{
      opacity:.6;
      cursor:not-allowed;
    }

    /* ===== FLIGHTS BOX ===== */
    .mini-title{
      font-family:Montserrat,Inter,sans-serif;
      font-weight:800;
      font-size:24px;
      margin:0 0 12px;
      color:var(--brand-blue);
      letter-spacing:-0.02em;
      text-transform:none;
    }

    .mini-grid{
      display:grid;
      grid-template-columns:auto 1fr;
      gap:10px 10px;
      align-items:center;
      width:100%;
      max-width:100%;
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    }

    .mini-grid > *{ min-width:0; }

    .mini-grid label{
      font-weight:800;
      color:#0f2f62;
      font-size:13px;
      letter-spacing:0.02em;
      white-space:nowrap;
      text-align:left;
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    }

    .mini-grid input,
    .mini-grid select{
      display:block;
      width:100%;
      max-width:100%;
      min-width:0;
      border:1px solid rgba(3,78,162,0.22);
      background:#fff;
      color:#0f2f62;
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      font-weight:700;
      padding:10px 12px;
      border-radius:14px;
      font-size:14px;
      outline:none;
      box-shadow:0 14px 30px rgba(3,78,162,0.10);
      height:44px;
      line-height:22px;
    }

    .mini-grid input[type="date"]{
      -webkit-appearance:none;
      appearance:none;
      width:100%;
      max-width:100%;
      min-width:0;
      height:44px;
    }

    .mini-grid input:focus,
    .mini-grid select:focus{
      box-shadow:0 0 0 4px rgba(3,78,162,0.16);
      border-color:rgba(3,78,162,0.45);
    }

    .mini-actions{
      margin-top:12px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .mini-hint{
      margin-top:12px;
      color:#24324a;
      opacity:.95;
      font-size:13.6px;
      line-height:1.45;
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    }

    .mini-link{
      color:#0f2f62;
      font-weight:900;
      text-decoration:underline;
      text-underline-offset:3px;
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    }

    /* ===== ITINERARY OUTPUT ===== */
    .itinerary{
      margin-top:16px;
    }

    .itinerary-shell{
      margin-top:12px;
      background:#fff;
      border-radius:22px;
      padding:22px;
      border:1px solid rgba(0,0,0,0.06);
      box-shadow:0 18px 55px rgba(3,78,162,0.12);
      min-height:140px;
      min-width:0;
    }

    .itinerary-shell .hint{ margin-top:0; }

    .day-card{
      border-radius:18px;
      border:1px solid rgba(0,0,0,0.06);
      background:#fff;
      padding:16px;
      box-shadow:0 14px 34px rgba(3,78,162,0.10);
    }
    .day-card + .day-card{ margin-top:12px; }

    .day-title{
      font-family:Montserrat,Inter,sans-serif;
      font-weight:800;
      margin:0 0 8px;
      color:#0f2f62;
      letter-spacing:-0.02em;
      font-size:18px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }

    .tag{
      font-size:12px;
      font-weight:900;
      color:#0f2f62;
      background:rgba(3,78,162,0.10);
      border:1px solid rgba(3,78,162,0.18);
      padding:6px 10px;
      border-radius:999px;
      white-space:nowrap;
    }

    .slot{
      margin-top:10px;
      padding:12px;
      border-radius:14px;
      background:linear-gradient(180deg, rgba(3,78,162,0.05), rgba(3,78,162,0.02));
      border:1px solid rgba(3,78,162,0.12);
    }

    .slot h4{
      margin:0 0 6px;
      font-weight:900;
      color:#0f2f62;
      font-size:13px;
      letter-spacing:0.02em;
      text-transform:uppercase;
    }

    .slot .title{
      font-weight:900;
      color:#0f2f62;
      margin:0 0 4px;
    }

    .slot .meta{
      color:#24324a;
      opacity:.95;
      font-size:14px;
      line-height:1.55;
      margin:0;
    }

    .hint{
      margin-top:10px;
      color:#24324a;
      opacity:.95;
      font-size:14.6px;
      line-height:1.6;
    }

    /* ===== EMAIL ITINERARY SECTION ===== */
    .email-divider{
      margin-top:16px;
      padding-top:16px;
      border-top:1px solid rgba(0,0,0,0.06);
    }

    .email-title{
      font-family:Montserrat,Inter,sans-serif;
      font-weight:800;
      font-size:18px;
      margin:0 0 6px;
      color:#0f2f62;
      letter-spacing:-0.02em;
    }

    .email-sub{
      margin:0 0 12px;
      color:#6E7B8B;
      font-size:14.6px;
      line-height:1.55;
      max-width:none;
    }

    .email-grid{
      display:grid;
      grid-template-columns:1fr 1fr 1.3fr;
      gap:10px;
      align-items:end;
    }

    .field{
      display:flex;
      flex-direction:column;
      gap:7px;
      margin:0;
    }

    .field label{
      font-weight:800;
      font-size:13px;
      color:#0f2f62;
      letter-spacing:.01em;
    }

    .input{
      width:100%;
      border-radius:14px;
      border:1px solid rgba(3,78,162,.18);
      background:#fff;
      padding:12px 12px;
      font-size:15px;
      font-weight:600;
      color:#162b55;
      outline:none;
      box-shadow:0 10px 26px rgba(3,78,162,.06);
      font-family:inherit;
      height:44px;
    }

    .input:focus{
      box-shadow:0 0 0 4px rgba(3,78,162,0.16);
      border-color:rgba(3,78,162,0.45);
    }

    .invite-card{
      margin-top:14px;
      border-radius:18px;
      border:1px solid rgba(0,0,0,0.06);
      background:linear-gradient(180deg, rgba(3,78,162,0.03), rgba(3,78,162,0.015));
      padding:14px;
    }

    .invite-card-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:12px;
    }

    .invite-title{
      font-weight:900;
      color:#0f2f62;
      letter-spacing:-0.01em;
    }

    .invite-hint{
      margin-top:10px;
      color:#24324a;
      opacity:.95;
      font-size:13.6px;
      line-height:1.45;
    }

    .invite-row{
      display:grid;
      grid-template-columns:1fr 1fr 1.3fr;
      gap:10px;
      align-items:end;
    }

    .invite-row + .invite-row{ margin-top:14px; }

    .invite-row-actions{
      display:flex;
      justify-content:flex-end;
      margin-top:10px;
    }

    .recipients-wrap{
      margin-top:14px;
      display:flex;
      flex-direction:column;
      gap:10px;
      align-items:flex-start;
    }

    .recipient-count{
      font-weight:900;
      color:#0f2f62;
    }

    .send-btn{
      width:auto;
    }

    .statusPill{
      display:none;
      margin-top:12px;
      width:fit-content;
      padding:9px 12px;
      border-radius:999px;
      font-weight:900;
      font-size:13px;
      border:1px solid rgba(3,78,162,.18);
      background:rgba(3,78,162,.06);
      color:#0f2f62;
    }
    .statusPill.show{ display:inline-flex; }

    /* ===== MOBILE ===== */
    @media(max-width:900px){
      .hero-banner{min-height:290px}

      .builder-layout{
        grid-template-columns:1fr;
        gap:14px;
      }

      #flightsDesktop{ display:none !important; }

      #flightsMobile{
        display:block !important;
        width:100%;
        max-width:100%;
        margin:14px 0 0;
      }

      .controls-grid{ grid-template-columns:1fr; }
      .controls-grid select{ width:100%; }

      .mini-grid{ grid-template-columns:1fr; }
      .mini-actions{ justify-content:flex-start; }

      .itinerary-shell{
        padding:18px;
        min-height:130px;
      }

      .pill-row.experiences-grid{
        grid-template-columns:repeat(2, 1fr);
      }
      .pill-row.experiences-grid .pill{
        width:100%;
        text-align:center;
        white-space:nowrap;
        overflow:hidden;
        text-overflow:ellipsis;
      }

      #regionsPills{
        display:grid;
        grid-template-columns:repeat(4, 1fr);
        gap:10px;
        margin-top:14px;
      }
      #regionsPills .pill{
        width:100%;
        text-align:center;
        white-space:nowrap;
        overflow:hidden;
        text-overflow:ellipsis;
      }

      /* Email stacks */
      .email-grid{
        grid-template-columns:1fr;
      }

      .invite-row{
        grid-template-columns:1fr;
      }

      .invite-card-head .btn{
        padding:12px 14px;
        border-radius:16px;
      }

      .invite-row-actions .btn{
        padding:12px 14px;
        border-radius:16px;
      }

      .send-btn{
        width:100%;
      }

      .recipients-wrap{
        width:100%;
      }
    }

    /* ===== DESKTOP-ONLY FIXES REQUESTED ===== */
    @media(min-width:901px){
      /* 1) Make "Número de días" select shorter (2 chars max) */
      .controls-grid{
        grid-template-columns:auto 120px;
      }
      #daysSelect{
        width:120px;
        padding-right:42px;
      }

      /* 2) Make ALL region/experience pills the same height on desktop */
      #regionsPills .pill,
      #experiencesPills .pill{
        height:40px;
        display:inline-flex;
        align-items:center;
        justify-content:center;
        line-height:1;
        white-space:nowrap;
        overflow:hidden;
        text-overflow:ellipsis;
      }

      /* 3) Flights CTA button: align left with "Vuelos" title and fill to the right edge */
      .flights-card .mini-actions{
        justify-content:flex-start;
      }
      .flights-card .mini-actions .btn{
        width:100%;
      }
    }

    @media(max-width:620px){
      .hero-content{padding:16px}

      .pill-row.experiences-grid{ grid-template-columns:1fr; }

      #regionsPills{
        grid-template-columns:repeat(4, 1fr);
        gap:8px;
      }
      #regionsPills .pill{
        padding:10px 8px;
        font-size:12.5px;
      }
    }
  </style>
</head>

<body>
  <div id="siteHeader"></div>

  <main>
    <section class="hero" aria-label="Hero del planificador de viajes">
      <div class="hero-banner" role="img" aria-label="Imagen del hero del planificador de viajes">
        <div class="hero-content">
          <div>
            <h1 class="hero-title">Planificador de Viajes</h1>
          </div>
        </div>
      </div>
    </section>

    <div class="wrap">
      <section class="builder-layout" aria-label="Planificador de viaje y vuelos">
        <section class="card builder-card" aria-label="Asistente del planificador">
          <h2 style="margin-bottom:10px;">Crea un itinerario personalizado por Ecuador</h2>
          <p>
            Elige la duración del viaje, regiones y experiencias. Luego genera un itinerario sugerido que puedes ajustar.
            Esta versión funciona por reglas y corre completamente en tu navegador.
          </p>

          <div class="builder-top" style="margin-top:14px;">
            <div class="controls-grid" aria-label="Controles del planificador">
              <label for="daysSelect">Número de días</label>
              <select id="daysSelect"></select>
            </div>
          </div>

          <div style="margin-top:16px;">
            <div class="section-title" style="font-size:18px;margin-bottom:10px;color:#0f2f62;">Elige regiones</div>

            <div class="regions-tip">
              Consejo: si seleccionas varias regiones, la herramienta dividirá los días automáticamente y sugerirá un ritmo más ligero para traslados.
            </div>

            <div class="pill-row" id="regionsPills" aria-label="Selección de regiones"></div>
            <div class="region-hint" id="regionHint"></div>
          </div>

          <div style="margin-top:18px;">
            <div class="section-title" style="font-size:18px;margin-bottom:10px;color:#0f2f62;">Elige experiencias</div>
            <div class="pill-row experiences-grid" id="experiencesPills" aria-label="Selección de experiencias"></div>
          </div>

          <div class="actions">
            <button class="btn primary" id="generateBtn" type="button" disabled>Generar itinerario</button>
            <button class="btn" id="resetBtn" type="button">Reiniciar</button>
          </div>
        </section>

        <aside class="card flights-card" id="flightsDesktop" aria-label="Vuelos (escritorio)">
          <p class="mini-title">Vuelos</p>

          <div class="mini-grid">
            <label for="flightFromDesktop">Desde</label>
            <input id="flightFromDesktop" type="text" inputmode="latin" autocomplete="off" placeholder="ej., JFK" maxlength="6">

            <label for="flightToDesktop">Hacia</label>
            <select id="flightToDesktop" aria-label="Aeropuerto de destino">
              <option value="UIO">Quito (UIO)</option>
              <option value="GYE">Guayaquil (GYE)</option>
              <option value="GPS">Galápagos (GPS)</option>
              <option value="CUE">Cuenca (CUE)</option>
            </select>

            <label for="flightDepartDesktop">Salida</label>
            <input id="flightDepartDesktop" type="date">

            <label for="flightReturnDesktop">Regreso</label>
            <input id="flightReturnDesktop" type="date">
          </div>

          <div class="mini-actions">
            <button class="btn primary" id="flightSearchBtnDesktop" type="button">Buscar vuelos</button>
          </div>

          <div class="mini-hint">
            Cuando confirmes vuelos e itinerario, revisa transporte local seguro:
            <a class="mini-link" href="/es/transporte/">Transporte</a>
          </div>
        </aside>
      </section>

      <section class="itinerary" aria-label="Itinerario generado">
        <div class="itinerary-shell" aria-label="Contenedor de salida del itinerario">
          <h2 class="section-title" style="margin:0 0 12px;">Tu itinerario sugerido</h2>
          <div id="output" class="hint">Selecciona días, regiones y experiencias. Luego haz clic en “Generar itinerario”.</div>

          <!-- Email itinerary -->
          <div class="email-divider" aria-label="Sección para enviar el itinerario por email">
            <h3 class="email-title">Enviar este itinerario por email</h3>
            <p class="email-sub">
              Primero genera un itinerario, luego ingresa tus datos. Puedes invitar hasta 3 viajeros adicionales.
            </p>

            <form id="eeTripEmailForm" autocomplete="on">
              <div class="email-grid">
                <div class="field">
                  <label for="tb_first_name">Nombre</label>
                  <input class="input" id="tb_first_name" name="first_name" type="text" autocomplete="given-name" required>
                </div>

                <div class="field">
                  <label for="tb_last_name">Apellido</label>
                  <input class="input" id="tb_last_name" name="last_name" type="text" autocomplete="family-name" required>
                </div>

                <div class="field">
                  <label for="tb_email">Email</label>
                  <input class="input" id="tb_email" name="email" type="email" autocomplete="email" required>
                </div>
              </div>

              <div class="invite-card" aria-label="Invitar viajeros">
                <div class="invite-card-head">
                  <div class="invite-title">Invitar viajeros (opcional)</div>
                  <button class="btn" id="tb_add_traveler" type="button">Agregar viajero</button>
                </div>

                <div id="tb_invite_list"></div>

                <div class="invite-hint">
                  Los viajeros invitados reciben un solo email con el itinerario y una línea corta de invitación.
                </div>
              </div>

              <div class="recipients-wrap">
                <div class="recipient-count" id="tb_recipient_count">Destinatarios: 1 email(s)</div>
                <button class="btn primary send-btn" id="tb_send_btn" type="submit" disabled>Enviar itinerario</button>
              </div>

              <div class="statusPill" id="tb_status" role="status" aria-live="polite"></div>
            </form>
          </div>
        </div>
      </section>

      <aside class="card flights-card" id="flightsMobile" aria-label="Vuelos (móvil)" style="display:none;">
        <p class="mini-title">Vuelos</p>

        <div class="mini-grid">
          <label for="flightFromMobile">Desde</label>
          <input id="flightFromMobile" type="text" inputmode="latin" autocomplete="off" placeholder="ej., JFK" maxlength="6">

          <label for="flightToMobile">Hacia</label>
          <select id="flightToMobile" aria-label="Aeropuerto de destino">
            <option value="UIO">Quito (UIO)</option>
            <option value="GYE">Guayaquil (GYE)</option>
            <option value="GPS">Galápagos (GPS)</option>
            <option value="CUE">Cuenca (CUE)</option>
          </select>

          <label for="flightDepartMobile">Salida</label>
          <input id="flightDepartMobile" type="date">

          <label for="flightReturnMobile">Regreso</label>
          <input id="flightReturnMobile" type="date">
        </div>

        <div class="mini-actions">
          <button class="btn primary" id="flightSearchBtnMobile" type="button">Buscar vuelos</button>
        </div>

        <div class="mini-hint">
          Cuando confirmes vuelos e itinerario, revisa transporte local seguro:
          <a class="mini-link" href="/es/transporte/">Transporte</a>
        </div>
      </aside>
    </div>
  </main>

  <div id="siteFooter"></div>

  <script>
    // ===== CONFIG: your Apps Script Web App URL =====
    const TRIP_EMAIL_WEBAPP_URL = "https://script.google.com/macros/s/AKfycbxUGlWoLwj5wlYXhqNa4fh4FZjBhQr_QOVbA8MhSfJwC_IV_6hqC5_leMG6RskFXTkj/exec";

    // ===== TRIP BUILDER =====
    const DATA = { regions: null, experiences: null, blocks: null };

    const state = {
      days: 5,
      selectedRegionIds: new Set(),
      selectedExperienceIds: new Set(),
      lastPlan: null,
      lastItineraryText: ""
    };

    const els = {
      daysSelect: document.getElementById('daysSelect'),
      regionsPills: document.getElementById('regionsPills'),
      experiencesPills: document.getElementById('experiencesPills'),
      generateBtn: document.getElementById('generateBtn'),
      resetBtn: document.getElementById('resetBtn'),
      output: document.getElementById('output'),
      regionHint: document.getElementById('regionHint')
    };

    const tripEmailEls = {
      form: document.getElementById('eeTripEmailForm'),
      first: document.getElementById('tb_first_name'),
      last: document.getElementById('tb_last_name'),
      email: document.getElementById('tb_email'),
      btn: document.getElementById('tb_send_btn'),
      status: document.getElementById('tb_status'),
      addTravelerBtn: document.getElementById('tb_add_traveler'),
      inviteList: document.getElementById('tb_invite_list'),
      recipientCount: document.getElementById('tb_recipient_count')
    };

    const flightEls = {
      desktop: {
        from: document.getElementById('flightFromDesktop'),
        to: document.getElementById('flightToDesktop'),
        depart: document.getElementById('flightDepartDesktop'),
        ret: document.getElementById('flightReturnDesktop'),
        btn: document.getElementById('flightSearchBtnDesktop')
      },
      mobile: {
        from: document.getElementById('flightFromMobile'),
        to: document.getElementById('flightToMobile'),
        depart: document.getElementById('flightDepartMobile'),
        ret: document.getElementById('flightReturnMobile'),
        btn: document.getElementById('flightSearchBtnMobile')
      }
    };

    function setEmailStatus(text, kind){
      if (!tripEmailEls.status) return;
      tripEmailEls.status.textContent = text;
      tripEmailEls.status.classList.add('show');
      tripEmailEls.status.style.borderColor = kind === "error" ? "rgba(180,35,24,.25)" : "rgba(3,78,162,.18)";
      tripEmailEls.status.style.background = kind === "error" ? "rgba(180,35,24,.06)" : "rgba(3,78,162,.06)";
      tripEmailEls.status.style.color = kind === "error" ? "#7a1f16" : "#0f2f62";
    }

    function clearEmailStatus(){
      if (!tripEmailEls.status) return;
      tripEmailEls.status.classList.remove('show');
      tripEmailEls.status.textContent = "";
    }

    function enableEmailButtonIfReady(){
      if (!tripEmailEls.btn) return;
      const ready = !!(state.lastPlan && state.lastItineraryText && state.lastItineraryText.trim().length > 0);
      tripEmailEls.btn.disabled = !ready;
    }

    // ===== Name auto-capitalize =====
    function capFirstLetter(s){
      const t = String(s || "");
      if (!t) return "";
      const trimmed = t.trimStart();
      if (!trimmed) return "";
      return trimmed.charAt(0).toUpperCase() + trimmed.slice(1);
    }

    function attachCapitalize(el){
      if (!el) return;
      el.addEventListener("input", () => {
        const v = el.value;
        const c = capFirstLetter(v);
        if (c !== v) el.value = c;
      });
      el.addEventListener("blur", () => {
        const v = el.value;
        const c = capFirstLetter(v);
        if (c !== v) el.value = c;
      });
    }

    attachCapitalize(tripEmailEls.first);
    attachCapitalize(tripEmailEls.last);

    // ===== Invite travelers UI =====
    const MAX_INVITES = 3;
    const inviteRows = []; // {wrap, first, last, email}

    function isValidEmail(s){
      const t = String(s || "").trim();
      if (!t) return false;
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t);
    }

    function getInvitees(){
      return inviteRows
        .map(r => ({
          first_name: (r.first.value || "").trim(),
          last_name: (r.last.value || "").trim(),
          email: (r.email.value || "").trim()
        }))
        .filter(x => x.first_name || x.last_name || x.email);
    }

    function getAllRecipientEmails(){
      const primary = (tripEmailEls.email.value || "").trim();
      const invitees = getInvitees().map(x => x.email).filter(Boolean
